2025-04-17 09:28:50,992 - INFO - ==================================================
2025-04-17 09:28:50,992 - INFO - INICIANDO TESTE COMPLETO DE FLUXO DE IMPRESSÃO
2025-04-17 09:28:50,992 - INFO - ==================================================
2025-04-17 09:28:50,992 - INFO - 
[ETAPA 1] Verificando ambiente
2025-04-17 09:28:50,992 - INFO - Sistema operacional: nt - win32
2025-04-17 09:28:50,992 - INFO - Diretório atual: C:\Users\caram\OneDrive\Área de Trabalho\AcriPrint Programa\Acriprint V3
2025-04-17 09:28:50,993 - INFO - Arquivo de configuração (config/printer_config.json) existe: True
2025-04-17 09:28:51,397 - INFO - Configuração atual: {
  "porta_manual": "",
  "baudrate": 9600,
  "timeout": 5,
  "largura_papel": 32,
  "caracteres_por_linha": 32,
  "tamanho_qrcode": 5,
  "avanco_final": 4,
  "cortar_papel": true,
  "codificacao": "cp850",
  "tipo_impressora": "58mm",
  "baudrates_alternativos": [
    9600,
    19200,
    38400,
    57600,
    115200
  ],
  "max_tentativas": 3,
  "metodos_impressao": [
    "win32",
    "serial",
    "html"
  ],
  "impressora_windows": "POS58 Printer",
  "impressoras_ignoradas": [
    "Microsoft XPS Document Writer",
    "Microsoft Print to PDF",
    "Fax",
    "OneNote",
    "EPSON L375"
  ],
  "verificar_porta_antes": true,
  "tempo_liberacao_porta": 3,
  "imprimir_logo": false,
  "usar_impressora_windows": true
}
2025-04-17 09:28:51,397 - INFO - 
[ETAPA 2] Carregando configurações da impressora
2025-04-17 09:28:52,028 - INFO - Configuração carregada: {
  "porta_manual": "",
  "baudrate": 9600,
  "timeout": 5,
  "largura_papel": 32,
  "caracteres_por_linha": 32,
  "tamanho_qrcode": 5,
  "avanco_final": 4,
  "cortar_papel": true,
  "codificacao": "cp850",
  "tipo_impressora": "58mm",
  "baudrates_alternativos": [
    9600,
    19200,
    38400,
    57600,
    115200
  ],
  "max_tentativas": 3,
  "metodos_impressao": [
    "win32",
    "serial",
    "html"
  ],
  "impressora_windows": "POS58 Printer",
  "impressoras_ignoradas": [
    "Microsoft XPS Document Writer",
    "Microsoft Print to PDF",
    "Fax",
    "OneNote",
    "EPSON L375"
  ],
  "verificar_porta_antes": true,
  "tempo_liberacao_porta": 3,
  "imprimir_logo": false,
  "usar_impressora_windows": true
}
2025-04-17 09:28:52,030 - INFO - 
[ETAPA 3] Detectando portas disponíveis
2025-04-17 09:28:52,591 - INFO - Portas detectadas:
2025-04-17 09:28:52,592 - INFO -  - COM3: Serial Padrão por link Bluetooth (COM3)
2025-04-17 09:28:52,592 - INFO -  - COM4: Serial Padrão por link Bluetooth (COM4)
2025-04-17 09:28:52,592 - INFO - 
[ETAPA 4] Testando conexão com a impressora
2025-04-17 09:28:52,592 - INFO - Porta configurada: ''
2025-04-17 09:28:52,592 - WARNING - Nenhuma porta configurada. Configure uma porta antes de continuar.
2025-04-17 09:28:52,593 - INFO - Sugestão: use a porta COM3
2025-04-17 09:28:52,593 - INFO - Configuração atualizada temporariamente com a porta COM3
2025-04-17 09:28:52,935 - INFO - Conectado com sucesso à porta COM3 (Baudrate: 9600)
2025-04-17 09:28:52,935 - INFO - Resultado da conexão: Sucesso
2025-04-17 09:28:52,935 - INFO - 
[ETAPA 5] Preparando pedido de teste
2025-04-17 09:28:52,936 - INFO - Pedido de teste criado: {
  "numero": "TESTE-092852",
  "data_pedido": "17/04/2025 09:28:52",
  "cliente": {
    "nome": "Cliente Teste",
    "telefone": "(00) 00000-0000"
  },
  "itens": [
    {
      "quantidade": 1,
      "descricao": "Item de Teste 1",
      "preco": 10.5,
      "observacao": "Observa\u00e7\u00e3o do item 1"
    },
    {
      "quantidade": 2,
      "descricao": "Item de Teste 2",
      "preco": 15.75,
      "observacao": "Observa\u00e7\u00e3o do item 2 com texto longo para testar quebra de linha autom\u00e1tica"
    }
  ],
  "total": 42.0,
  "observacao": "Observa\u00e7\u00e3o geral do pedido de teste",
  "qrcode": "https://teste.acriprint.com.br/pedido/TESTE"
}
2025-04-17 09:28:52,936 - INFO - 
[ETAPA 6] Formatando o pedido internamente
2025-04-17 09:28:52,936 - INFO - Texto formatado para impressão (primeiras 5 linhas):
2025-04-17 09:28:52,937 - INFO -               ACRIPRINT
2025-04-17 09:28:52,937 - INFO -                 PEDIDO
2025-04-17 09:28:52,937 - INFO -    --------------------------------
2025-04-17 09:28:52,937 - INFO -    Pedido: TESTE-092852
2025-04-17 09:28:52,937 - INFO -    Data: 17/04/2025 09:28:52
2025-04-17 09:28:52,937 - INFO - ...
2025-04-17 09:28:52,938 - INFO - 
[ETAPA 7] Testando métodos de impressão individualmente
2025-04-17 09:28:52,938 - INFO - [7.1] Testando método SERIAL
2025-04-17 09:28:58,048 - ERROR - Erro na impressão serial: Write timeout
2025-04-17 09:28:58,048 - INFO - Resultado da impressão SERIAL: Falha
2025-04-17 09:28:58,048 - INFO - [7.2] Testando método WINDOWS
2025-04-17 09:28:58,049 - INFO - Preparando impressão via Windows...
2025-04-17 09:28:58,049 - INFO - Usando impressora configurada: POS58 Printer
2025-04-17 09:28:58,053 - INFO - Enviando arquivo para impressão: C:\Users\caram\AppData\Local\Temp\acriprint_win_20250417_092858.txt
2025-04-17 09:28:58,165 - INFO - Impressão Windows enviada com sucesso
2025-04-17 09:28:58,165 - INFO - Resultado da impressão WINDOWS: Sucesso
2025-04-17 09:28:58,165 - INFO - [7.3] Testando método HTML
2025-04-17 09:28:58,385 - INFO - Resultado da impressão HTML: Sucesso
2025-04-17 09:28:58,386 - INFO - 
[ETAPA 8] Executando fluxo completo de impressão
2025-04-17 09:28:58,387 - INFO - Arquivo de resultado: teste_resultado_20250417_092858.json
2025-04-17 09:28:58,387 - INFO - Iniciando impressão do pedido: TESTE-092852
2025-04-17 09:28:58,387 - INFO - Métodos de impressão disponíveis: ['win32', 'serial', 'html']
2025-04-17 09:28:58,387 - INFO - Tentando impressão via Serial (ESC/POS)...
2025-04-17 09:29:03,497 - ERROR - Erro na impressão serial: Write timeout
2025-04-17 09:29:03,498 - INFO - Tentando impressão via Windows...
2025-04-17 09:29:03,498 - INFO - Preparando impressão via Windows...
2025-04-17 09:29:03,499 - INFO - Usando impressora configurada: POS58 Printer
2025-04-17 09:29:03,503 - INFO - Enviando arquivo para impressão: C:\Users\caram\AppData\Local\Temp\acriprint_win_20250417_092903.txt
2025-04-17 09:29:03,557 - INFO - Impressão Windows enviada com sucesso
2025-04-17 09:29:03,557 - INFO - Impressão via Windows bem-sucedida.
2025-04-17 09:29:03,559 - INFO - Resultado registrado em teste_resultado_20250417_092858.json: SUCESSO
2025-04-17 09:29:03,559 - INFO - Resultado do fluxo completo: Sucesso
2025-04-17 09:29:03,568 - INFO - Conteúdo do arquivo de resultado: {
  "timestamp": "2025-04-17 09:29:03",
  "pedido": "TESTE-092852",
  "status": "SUCESSO",
  "sucesso": true
}
2025-04-17 09:29:03,568 - INFO - 
[ETAPA 9] Testando a fila de impressão
2025-04-17 09:29:03,569 - INFO - Serviço de impressão iniciado
2025-04-17 09:29:03,569 - INFO - Adicionando pedido à fila...
2025-04-17 09:29:03,569 - INFO - Pedido adicionado à fila: TESTE-092852
2025-04-17 09:29:03,569 - INFO - Iniciando impressão do pedido: TESTE-092852
2025-04-17 09:29:03,571 - INFO - Aguardando processamento (5 segundos)...
2025-04-17 09:29:03,571 - INFO - Métodos de impressão disponíveis: ['win32', 'serial', 'html']
2025-04-17 09:29:03,571 - INFO - Tentando impressão via Serial (ESC/POS)...
2025-04-17 09:29:08,571 - INFO - Tamanho da fila após processamento: aproximadamente 0
2025-04-17 09:29:08,681 - ERROR - Erro na impressão serial: Write timeout
2025-04-17 09:29:08,681 - INFO - Tentando impressão via Windows...
2025-04-17 09:29:08,682 - INFO - Preparando impressão via Windows...
2025-04-17 09:29:08,682 - INFO - Usando impressora configurada: POS58 Printer
2025-04-17 09:29:08,685 - INFO - Enviando arquivo para impressão: C:\Users\caram\AppData\Local\Temp\acriprint_win_20250417_092908.txt
2025-04-17 09:29:08,729 - INFO - Impressão Windows enviada com sucesso
2025-04-17 09:29:08,729 - INFO - Impressão via Windows bem-sucedida.
2025-04-17 09:29:08,729 - INFO - Serviço de impressão parado
2025-04-17 09:29:08,729 - INFO - 
[ETAPA 10] Finalizando teste
2025-04-17 09:29:08,730 - INFO - Desconectado da impressora
2025-04-17 09:29:08,730 - INFO - Conexão com a impressora encerrada
2025-04-17 09:29:08,730 - INFO - Teste concluído!
2025-04-17 09:29:08,730 - INFO - ==================================================
2025-04-17 09:29:08,730 - INFO - FIM DO TESTE DE FLUXO DE IMPRESSÃO
2025-04-17 09:29:08,731 - INFO - ==================================================
